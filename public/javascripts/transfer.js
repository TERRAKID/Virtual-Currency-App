const baseUrl=window.location.protocol+"//"+window.location.host;let btnConfirm=document.querySelector(".btn--confirm");const alert=document.querySelector(".alert"),alertText=document.querySelector(".alert__text");primus=Primus.connect(baseUrl,{reconnect:{max:1/0,min:500,retries:10}}),fetch(baseUrl+"/api/v1/currency/transfers",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>{}).catch(e=>{logout()}),logout=()=>{localStorage.removeItem("token"),window.location.href="/login"},btnConfirm.addEventListener("click",()=>{let e=document.querySelector("#to").value,t=document.querySelector("#amount").value,o=document.querySelector("#reason").value,r=document.querySelector("#message").value;fetch(baseUrl+"/api/v1/currency/transfers",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({to:e,amount:t,reason:o,message:r})}).then(e=>e.json()).then(n=>{"success"===n.status?(primus.write({action:"showCurrency",data:n.data}),deductCurrency(e,t,o,r)):(alertText.textContent="Whoops, something went wrong. We were unable to transfer the coins.",alert.classList.remove("hidden"))}).catch(e=>{logout()})}),addCurrency=(e,t,o,r)=>{fetch(baseUrl+"/api/v1/currency/addcurrency",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({to:e,amount:t})}).then(e=>e.json()).then(e=>{window.location.href="/"}).catch(e=>{logout()})},deductCurrency=(e,t,o,r)=>{fetch(baseUrl+"/api/v1/currency/deductcurrency",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({amount:t})}).then(e=>e.json()).then(n=>{"success"===n.status&&addCurrency(e,t,o,r)}).catch(e=>{logout()})};