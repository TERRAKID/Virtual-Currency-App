const baseUrl=window.location.protocol+"//"+window.location.host;let btnConfirm=document.querySelector(".btn--confirm");const alert=document.querySelector(".alert"),alertText=document.querySelector(".alert__text");let users=[];primus=Primus.connect(baseUrl,{reconnect:{max:1/0,min:500,retries:10}}),fetch(baseUrl+"/api/v1/currency/transfers",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>{}).catch(e=>{logout()}),logout=()=>{localStorage.removeItem("token"),window.location.href="/login"},btnConfirm.addEventListener("click",()=>{let e;users.find(e=>e.label===document.querySelector("#to").value)&&(e=users.find(e=>e.label).value);let t=document.querySelector("#amount").value,o=document.querySelector("#reason").value,n=document.querySelector("#message").value;fetch(baseUrl+"/api/v1/currency/transfers",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({to:e,amount:t,reason:o,message:n})}).then(e=>e.json()).then(r=>{"success"===r.status?(primus.write({action:"showCurrency",data:r.data}),deductCurrency(e,t,o,n)):(alertText.textContent="Whoops, something went wrong. We were unable to transfer the coins.",alert.classList.remove("hidden"))}).catch(e=>{logout()})}),addCurrency=(e,t,o,n)=>{fetch(baseUrl+"/api/v1/currency/addcurrency",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({to:e,amount:t})}).then(e=>e.json()).then(e=>{window.location.href="/"}).catch(e=>{logout()})},deductCurrency=(e,t,o,n)=>{fetch(baseUrl+"/api/v1/currency/deductcurrency",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify({amount:t})}).then(e=>e.json()).then(r=>{"success"===r.status&&addCurrency(e,t,o,n)}).catch(e=>{logout()})},fetch(baseUrl+"/api/v1/currency/leaderboard",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>e.json()).then(e=>{e.data.currency.forEach(e=>{user={label:e.firstname+" "+e.lastname,value:e.username},users.push(user)})}).catch(e=>{logout()});var input=document.getElementById("to");autocomplete({input:input,minLength:2,fetch:function(e,t){e=e.toLowerCase(),t(users.filter(t=>t.label.toLowerCase().startsWith(e)))},onSelect:function(e){input.value=e.label},emptyMsg:"No user found"});